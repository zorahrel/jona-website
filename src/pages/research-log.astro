---
import Layout from "../layouts/Layout.astro";

const sections = [
  {
    id: "herstories",
    label: "HERstories",
    code: "Ⓣ⓪➀",
    location: "Femminamorta, Giarre",
    duration: "13-16/8/2025",
    facilitator: "Hiram Salsano, Rachele Andrioli, Barbara Crescimanno",
    content: [
      "The masterclass is led by teachers from different regions of Southern Italy (Puglia, Sicily, Campania), who will guide participants through the women's vocal and percussion repertoire of the South, and into the relationship between body movement and frame drum, drawing on techniques of the ancient Greek chorus and its rhythmic–choral movement in space.",
      "Starting from the dynamics of the percussion circle, the work expands into movement through space, exploring how bodies and sounds relate physically and rhythmically in lines and ranks, and then in more complex formations such as diamonds, flocks, and packs.",
      "Through choral movement, traditional singing, and percussion, participants will work on homophony/unison and vocal and percussive polyrhythms; on the voice as it is tied to gesture and movement; and on the drum as both musical and expressive instrument.",
      "Drawing on each participant's skills and capacities, the masterclass encourages group-based artistic creation, helping everyone to engage with and gradually master the mechanisms of collective performance.",
    ],
  },
  {
    id: "cantare",
    label: "CANTARE NEI LUOGHI",
    code: "Ⓣ⓪➁",
    location: "TBD",
    duration: "TBD",
    facilitator: "TBD",
    content: [
      "An exploration of site-specific singing practices, investigating how voice and acoustic space create meaning together. This research track examines the relationship between traditional singing practices and the environments in which they were performed and developed.",
      "The project explores how geographical, architectural, and natural spaces have shaped vocal techniques, repertoires, and the social functions of singing across Mediterranean cultures.",
    ],
  },
  {
    id: "choros",
    label: "CHOROS",
    code: "Ⓣ⓪➂",
    location: "TBD",
    duration: "TBD",
    facilitator: "TBD",
    content: [
      "An investigation into the ancient Greek chorus as a model for collective embodied practice. This research explores the techniques and principles of choral movement, rhythm, and voice that connected individuals to their community and cosmos.",
      "The chorus was more than performance—it was a technology of coordination, synchronization, and collective intelligence that this research seeks to understand and reactivate.",
    ],
  },
  {
    id: "ccta",
    label: "CCTA",
    code: "Ⓣ⓪➃",
    location: "TBD",
    duration: "TBD",
    facilitator: "TBD",
    content: [
      "Cross-Cultural Transmodal Aesthetics: an interdisciplinary investigation into how different cultures perceive, process, and express sensory experience across modalities.",
      "This research examines the bridges between sound, movement, visual perception, and meaning-making, seeking universal patterns and culturally-specific innovations in human aesthetic experience.",
    ],
  },
  {
    id: "embodied",
    label: "EMBODIED MUSICALITY",
    code: "Ⓣ⓪➄",
    location: "TBD",
    duration: "TBD",
    facilitator: "TBD",
    content: [
      "An exploration of how musical knowledge is stored, transmitted, and expressed through the body. This research investigates the somatic dimensions of musical practice—how rhythm lives in the muscles, how melody is felt in the breath.",
      "The project draws on neuroscience, phenomenology, and traditional practices to understand how the body thinks musically and how this embodied intelligence can be cultivated and shared.",
    ],
  },
];
---

<Layout
  title="Research Log - Design for the Continuum"
  activePage="research-log"
  fitContent={true}
>
  <div class="curtains-container">
    {
      sections.map((section, index) => (
        <div class="curtain" data-index={index} data-section={section.id}>
          {/* Tab handle - always visible */}
          <button
            class="curtain-handle"
            aria-expanded="false"
            aria-controls={`panel-${section.id}`}
          >
            <span class="handle-border" />
            <span class="handle-gradient" />
            <span class="handle-text">
              <span class="handle-label">{section.label}</span>
              <span class="handle-code">{section.code}</span>
            </span>
          </button>

          {/* Panel content - hidden when collapsed */}
          <div class="curtain-panel" id={`panel-${section.id}`}>
            <div class="panel-inner">
              <div class="panel-header">
                <h1 class="panel-title">{section.label}</h1>
                <p class="panel-code">{section.code}</p>
                <div class="panel-meta">
                  <p>location: {section.location}</p>
                  <p>duration: {section.duration}</p>
                  <p>facilitator: {section.facilitator}</p>
                </div>
              </div>

              <div class="panel-body">
                <div class="panel-image" />
                <div class="panel-text">
                  {section.content.map((p) => (
                    <p>{p}</p>
                  ))}
                </div>
              </div>
            </div>
          </div>
        </div>
      ))
    }
  </div>
</Layout>

<style>
  /* ===== CONTAINER ===== */
  .curtains-container {
    display: flex;
    width: 100%;
    align-items: stretch;
    flex: 1;
    min-height: 0;
    position: relative;
  }

  /* ===== CURTAIN (each expandable section) ===== */
  .curtain {
    display: flex;
    flex-shrink: 0;
    transition: flex 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    min-width: 0;
    position: relative;
  }

  /* Collapsed state - ensure handles always visible */
  .curtain:not(.open) {
    flex: 0 0 auto;
  }

  /* Expanded state */
  .curtain.open {
    flex: 1 1 0;
    min-width: 0;
    z-index: 10;
  }

  /* ===== HANDLE (clickable tab) ===== */
  .curtain-handle {
    position: relative;
    width: 70px;
    flex-shrink: 0;
    align-self: stretch;
    background: transparent;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    padding-top: 2.5rem;
    transition: width 0.4s ease;
  }

  .curtain-handle:hover .handle-gradient {
    opacity: 0.95;
  }

  .curtain.open .curtain-handle {
    width: 90px;
  }

  .curtain.open .curtain-handle .handle-gradient {
    opacity: 1;
    background: linear-gradient(
      to right,
      rgba(255, 123, 172, 1) 0%,
      rgba(255, 123, 172, 0.85) 30%,
      rgba(255, 123, 172, 0.5) 60%,
      rgba(255, 123, 172, 0.15) 85%,
      transparent 100%
    );
  }

  /* Border line */
  .handle-border {
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 3px;
    background: var(--color-charcoal);
    z-index: 2;
  }

  /* Gradient */
  .handle-gradient {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      to right,
      rgba(255, 123, 172, 0.7) 0%,
      rgba(255, 123, 172, 0.4) 35%,
      rgba(255, 123, 172, 0.1) 70%,
      transparent 100%
    );
    opacity: 0.75;
    transition:
      opacity 0.3s ease,
      background 0.3s ease;
    z-index: 1;
  }

  /* Text */
  .handle-text {
    position: relative;
    z-index: 3;
    writing-mode: vertical-lr;
    text-orientation: mixed;
    transform: rotate(180deg);
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 0.5rem;
  }

  .handle-label {
    font-size: 1.125rem;
    font-weight: 900;
    letter-spacing: 0.01em;
    text-transform: uppercase;
    white-space: nowrap;
  }

  .handle-code {
    font-size: 0.875rem;
    font-weight: 600;
    opacity: 0.7;
  }

  /* ===== PANEL (expandable content) ===== */
  .curtain-panel {
    flex: 1;
    overflow: hidden;
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transition:
      opacity 0.4s ease-out,
      visibility 0.4s ease-out;
  }

  .curtain.open .curtain-panel {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
    overflow-y: auto;
  }

  .panel-inner {
    padding: 2rem 2.5rem;
    min-width: 600px;
  }

  /* ===== PANEL HEADER ===== */
  .panel-header {
    border-left: 4px solid var(--color-pink);
    padding-left: 1.5rem;
    margin-bottom: 2rem;
  }

  .panel-title {
    font-size: clamp(3rem, 7vw, 6rem);
    font-weight: 900;
    line-height: 0.9;
    letter-spacing: -0.02em;
    margin-bottom: 0.25rem;
  }

  .panel-code {
    font-size: clamp(1.5rem, 3.5vw, 3rem);
    font-weight: 900;
    line-height: 1;
    margin-bottom: 1.25rem;
  }

  .panel-meta {
    font-size: 1rem;
    font-weight: 600;
    line-height: 1.6;
  }

  .panel-meta p {
    margin: 0.125rem 0;
  }

  /* ===== PANEL BODY ===== */
  .panel-body {
    display: grid;
    grid-template-columns: minmax(180px, 320px) 1fr;
    gap: 2rem;
    align-items: start;
  }

  .panel-image {
    aspect-ratio: 1 / 1;
    background: var(--color-charcoal);
    width: 100%;
  }

  .panel-text {
    font-size: 1.0625rem;
    font-weight: 600;
    line-height: 1.4;
  }

  .panel-text p {
    margin-bottom: 1.25rem;
  }

  .panel-text p:last-child {
    margin-bottom: 0;
  }

  /* Final border on the right of container */
  .curtains-container::after {
    content: "";
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    width: 3px;
    background: var(--color-charcoal);
    pointer-events: none;
  }

  /* ===== RESPONSIVE ===== */
  @media (max-width: 1200px) {
    .curtain-handle {
      width: 60px;
    }

    .curtain.open .curtain-handle {
      width: 75px;
    }

    .handle-label {
      font-size: 1rem;
    }

    .handle-code {
      font-size: 0.75rem;
    }

    .panel-inner {
      padding: 1.5rem 2rem;
      min-width: 450px;
    }

    .panel-body {
      grid-template-columns: minmax(150px, 250px) 1fr;
      gap: 1.5rem;
    }
  }

  @media (max-width: 900px) {
    .curtain-handle {
      width: 50px;
    }

    .curtain.open .curtain-handle {
      width: 60px;
    }

    .handle-label {
      font-size: 0.8125rem;
    }

    .handle-code {
      font-size: 0.6875rem;
    }

    .panel-inner {
      min-width: 350px;
    }

    .panel-body {
      grid-template-columns: 1fr;
    }

    .panel-image {
      max-width: 280px;
    }
  }

  @media (max-width: 600px) {
    .curtain-handle {
      width: 42px;
      padding-top: 1.5rem;
    }

    .curtain.open .curtain-handle {
      width: 50px;
    }

    .handle-label {
      font-size: 0.6875rem;
    }

    .handle-code {
      font-size: 0.5625rem;
    }

    .panel-inner {
      padding: 1.25rem 1.5rem;
      min-width: 200px;
    }

    .panel-title {
      font-size: 2rem;
    }

    .panel-code {
      font-size: 1.25rem;
    }

    .panel-text {
      font-size: 0.9375rem;
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const curtains = document.querySelectorAll<HTMLElement>(".curtain");
    const handles =
      document.querySelectorAll<HTMLButtonElement>(".curtain-handle");

    function openCurtain(index: number) {
      // Close all curtains
      curtains.forEach((c) => c.classList.remove("open"));
      handles.forEach((h) => h.setAttribute("aria-expanded", "false"));

      // Open the selected one
      curtains[index].classList.add("open");
      handles[index].setAttribute("aria-expanded", "true");
    }

    function closeAll() {
      curtains.forEach((c) => c.classList.remove("open"));
      handles.forEach((h) => h.setAttribute("aria-expanded", "false"));
    }

    // Click handlers
    handles.forEach((handle, index) => {
      handle.addEventListener("click", () => {
        const isOpen = curtains[index].classList.contains("open");
        if (isOpen) {
          closeAll();
        } else {
          openCurtain(index);
        }
      });
    });

    // Keyboard navigation
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        closeAll();
        return;
      }

      const openIndex = Array.from(curtains).findIndex((c) =>
        c.classList.contains("open")
      );
      if (openIndex === -1) return;

      if (e.key === "ArrowRight") {
        e.preventDefault();
        const next = Math.min(openIndex + 1, curtains.length - 1);
        if (next !== openIndex) openCurtain(next);
      } else if (e.key === "ArrowLeft") {
        e.preventDefault();
        const prev = Math.max(openIndex - 1, 0);
        if (prev !== openIndex) openCurtain(prev);
      }
    });

    // Open first curtain by default
    openCurtain(0);
  });
</script>
