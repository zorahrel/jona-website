---
import Layout from "../layouts/Layout.astro";

const sections = [
  {
    id: "herstories",
    label: "HERstories",
    code: "Ⓣ⓪➀",
    location: "femminamorta, giarre",
    duration: "13-16/8/2025",
    facilitator: "hiram salsano, rachele andrioli, barbara crescimanno",
    content: [
      "The masterclass is led by teachers from different regions of Southern Italy (Puglia, Sicily, Campania), who will guide participants through the women's vocal and percussion repertoire of the South, and into the relationship between body movement and frame drum, drawing on techniques of the ancient Greek chorus and its rhythmic–choral movement in space.",
      "Starting from the dynamics of the percussion circle, the work expands into movement through space, exploring how bodies and sounds relate physically and rhythmically in lines and ranks, and then in more complex formations such as diamonds, flocks, and packs. The chorus gradually becomes three-dimensional, opening toward the outside and engaging with its surroundings.",
      "Through choral movement, traditional singing, and percussion, participants will work on homophony/unison and vocal and percussive polyrhythms; on the voice as it is tied to gesture and movement; and on the drum as both musical and expressive instrument. Attention will be given to coordination between body movement, rhythm on the drum, and voice, to converging and diverging rhythms and movements, on- and off-beat patterns, pauses, doubled and halved tempos, basic pulse and rhythmic cells, and meters in 2, in 3, and their combinations.",
      "Drawing on each participant's skills and capacities, the masterclass encourages group-based artistic creation, helping everyone to engage with and gradually master the mechanisms of collective creativity. This working method underpins communication and community-building processes, and trains practices of hospitality and the creation of inclusive spaces of encounter and mutual support.",
    ],
    images: [
      "/research/herstories/48C3BA15-E238-4007-A5F5-C3DEB7A47569_1_102_o.jpeg",
      "/research/herstories/7EEB5B1D-FCB6-4766-8AFE-4118A15272AF_1_105_c.jpeg",
      "/research/herstories/A001ABBF-14D2-4C94-9784-DDB6A59BDB02_1_102_o.jpeg",
    ],
  },
  {
    id: "cantare",
    label: "CANTARE NEI LUOGHI",
    code: "Ⓣ⓪➁",
    location: "exconvento, belmonte calabro",
    duration: "1-5/10/2025",
    facilitator: "hanna maria civico, mattia carlucci",
    content: [
      'This residential project explores practices of voice, embodiment, and song, working with the body-as-voice, space, polyvocal and monodic peasant oral traditions, improvisation, places, relationships, and the Mediterranean and Near Eastern "otherworld."',
      "The soundscape around us is reflected in our inner, physical, and emotional world.",
      "Agro-pastoral song emerged under multidimensional pressures and in close relation to its environmental and communal context. Concrete spaces with unique acoustic qualities are woven, transparently, into musical structures, threading together bleats, tears, gusts of wind, creaks, stories, emotional and sonic vibrations. What reaches us from the vanished rural world is a melody, a musical piece, a fragment. Each time, it is up to us to reassemble the sonic material back toward the sources that generated it, recovering parts that arrive damaged and coherently expanding their form. To do this, we must develop an adequate instrument: to radicalise the voice and song (and the ear) through a branching process that also acts on our bonds with places as physical and affective spaces, and as access points to the sources of memory and sound.",
      "To sing a song of the past, when we have indications of its melodic-rhythmic contour, its sound, its vocal timbres or those of an instrument, means confronting our own timbre and how we inhabit our voice, our instrument, in the contemporary.",
    ],
    images: [
      "/research/cantare-nei-luoghi/000832490005.jpg",
      "/research/cantare-nei-luoghi/000832490021.jpg",
      "/research/cantare-nei-luoghi/000832500014.jpg",
      "/research/cantare-nei-luoghi/000832500024.jpg",
      "/research/cantare-nei-luoghi/000832500025.jpg",
    ],
  },
  {
    id: "choros",
    label: "CHOROS",
    code: "Ⓣ⓪➂",
    location: "arci tavola rotonda, palermo",
    duration: "10-12/10/2025",
    facilitator: "barbara crescimanno",
    content: [
      'The CHORÓS Choral Practice Laboratory is a theatre training path that uses techniques and repertoires of Southern Italian dances and rhythms as tools to build a contemporary "Greek chorus," weaving together work on voice, dance, and frame drum.',
      "In the Greek chorus, the moving body creates rhythmic patterns and choreographies and becomes a symbolic form that shapes identities, gender and power roles, relations and hierarchies, and the social and political spaces of a community. Music and dance are cultural phenomena that allow us to read history in a broad sense and are powerful tools for education and for the growth of the self-in-community.",
      "Starting from the body, the work focuses on physical perception, posture and proxemics in space; using step and movement as means of relation and expression; using the body as percussion; breathing and producing melodic and rhythmic vocal sound, exploring both choral and solo expression; and integrating frame-drum techniques and Southern Italian traditional songs into choral movement and theatrical action.",
    ],
    images: [
      "/research/choros/000832470001.jpg",
      "/research/choros/000832470004.jpg",
      "/research/choros/000832470005.jpg",
    ],
  },
  {
    id: "ccta",
    label: "CCTA",
    code: "Ⓣ⓪➃",
    location: "off topic, torino",
    duration: "3-8/11/2025",
    facilitator: "giovanni morassutti, serena bavo",
    content: [
      "Climate Change Theatre Action (CCTA), created in 2015, brings together theatre groups who stage around 50 short plays on the climate crisis, with the goal of uniting communities around the world and encouraging them to take local and global action for the climate.",
      "This international initiative, which every two years gathers artists from across the globe to raise awareness about the climate emergency, arrives this year in Turin, in collaboration with Earthink Festival 2025 #TERRA.",
      "In Turin, actor and director Giovanni Enrico Morassutti led an artistic residency together with Serena Bavo, culminating in a site-specific, itinerant performance at the Einaudi Campus of the University of Turin, where audiences followed a sound-based route through symbolic locations and experienced three CCTA plays: The Polar Bears by Nicolas Billon, Brackendale by Elaine Ávila, and Homo Sapiens by Chantal Bilodeau.",
    ],
    images: [
      "/research/ccta/000832470028.jpg",
      "/research/ccta/000832470032.jpg",
    ],
  },
  {
    id: "embodied",
    label: "EMBODIED MUSICALITY",
    code: "Ⓣ⓪➄",
    location: "casa nel parco, mirafiori (torino)",
    duration: "15/11/2025",
    facilitator: "labperm / domenico castaldo",
    content: [
      "A performative and participatory event at the same time; a choral community gathering; an organic practice of group singing, open to all. For us, Liturgia is a secular rite: it restores to the artistic stage the spiritual function of theatre.",
      "The spirit manifests itself in the creative act, in its deepest and truest impulses, but also in what is playful and full of life. In this sense, the healing outcome of Liturgia emerges for everyone who takes part.",
      "The use of voice and song harmonises the breath, quiets the mind, centres attention, and balances the vital forces within the individual. Physical action reveals and releases emotional blocks. Creativity becomes a way to move beyond the conflicts and emotions that condition our relationships with the outside world.",
      "Liturgia is an event that animates the flesh and gives incarnation to the soul.",
    ],
  },
];
---

<Layout
  title="Research Log - Design for the Continuum"
  activePage="research-log"
  fitContent={true}
>
  <div class="curtains-container">
    {
      sections.map((section, index) => (
        <div class="curtain" data-index={index} data-section={section.id}>
          {/* Tab handle - always visible */}
          <button
            class="curtain-handle"
            aria-expanded="false"
            aria-controls={`panel-${section.id}`}
          >
            <span class="handle-border" />
            <span class="handle-gradient" />
            <span class="handle-text">
              <span class="handle-label">{section.label}</span>
              <span class="handle-code">{section.code}</span>
            </span>
          </button>

          {/* Panel content - hidden when collapsed */}
          <div class="curtain-panel" id={`panel-${section.id}`}>
            <div class="panel-inner">
              <div class="panel-header">
                <h1 class="panel-title">{section.label}</h1>
                <p class="panel-code">{section.code}</p>
                <div class="panel-meta">
                  <p>location: {section.location}</p>
                  <p>duration: {section.duration}</p>
                  <p>facilitator: {section.facilitator}</p>
                </div>
              </div>

              <div
                class={`panel-body${section.images ? "" : " panel-body--single"}`}
              >
                {section.images && (
                  <div class="panel-gallery">
                    {section.images.map((src, imgIndex) => (
                      <figure class="panel-photo">
                        <img
                          src={src}
                          alt={`${section.label} photo ${imgIndex + 1}`}
                          loading="lazy"
                        />
                      </figure>
                    ))}
                  </div>
                )}
                <div class="panel-text">
                  {section.content.map((p) => (
                    <p>{p}</p>
                  ))}
                </div>
              </div>
            </div>
          </div>
        </div>
      ))
    }
  </div>
</Layout>

<style>
  /* ===== CONTAINER ===== */
  .curtains-container {
    display: flex;
    width: 100%;
    align-items: stretch;
    flex: 1;
    min-height: 0;
  }

  /* When all curtains are closed, align handles to the right */
  .curtains-container.all-closed {
    justify-content: flex-end;
  }

  /* ===== CURTAIN (each expandable section) ===== */
  .curtain {
    display: flex;
    flex-shrink: 0;
    transition: flex 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    min-width: 0;
  }

  /* Collapsed state - ensure handles always visible */
  .curtain:not(.open) {
    flex: 0 0 auto;
  }

  /* Expanded state */
  .curtain.open {
    flex: 1 1 0;
    min-width: 0;
  }

  /* ===== HANDLE (clickable tab) ===== */
  .curtain-handle {
    position: relative;
    width: 70px;
    flex-shrink: 0;
    align-self: stretch;
    background: transparent;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    padding-top: 2.5rem;
    transition: width 0.4s ease;
  }

  .curtain-handle:hover .handle-gradient {
    opacity: 0.95;
  }

  .curtain.open .curtain-handle {
    width: 90px;
  }

  .curtain.open .curtain-handle .handle-gradient {
    opacity: 1;
    background: linear-gradient(
      to right,
      rgba(255, 123, 172, 1) 0%,
      rgba(255, 123, 172, 0.85) 30%,
      rgba(255, 123, 172, 0.5) 60%,
      rgba(255, 123, 172, 0.15) 85%,
      transparent 100%
    );
  }

  /* Border line */
  .handle-border {
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 3px;
    background: var(--color-charcoal);
    z-index: 2;
  }

  /* Gradient */
  .handle-gradient {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      to right,
      rgba(255, 123, 172, 0.7) 0%,
      rgba(255, 123, 172, 0.4) 35%,
      rgba(255, 123, 172, 0.1) 70%,
      transparent 100%
    );
    opacity: 0.75;
    transition:
      opacity 0.3s ease,
      background 0.3s ease;
    z-index: 1;
  }

  /* Text */
  .handle-text {
    position: relative;
    z-index: 3;
    writing-mode: vertical-lr;
    text-orientation: mixed;
    transform: rotate(180deg);
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 0.5rem;
  }

  .handle-label {
    font-size: 1.125rem;
    font-weight: 900;
    letter-spacing: 0.01em;
    text-transform: uppercase;
    white-space: nowrap;
  }

  .handle-code {
    font-size: 0.875rem;
    font-weight: 600;
    opacity: 0.7;
  }

  /* ===== PANEL (expandable content) ===== */
  .curtain-panel {
    display: none;
    flex: 1;
    overflow: hidden;
  }

  .curtain.open .curtain-panel {
    display: block;
    opacity: 1;
    overflow-y: auto;
    animation: fadeInPanel 0.4s ease-out;
  }

  @keyframes fadeInPanel {
    from {
      opacity: 0;
      transform: translateX(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .panel-inner {
    padding: 2rem 2.5rem;
    min-width: 600px;
  }

  /* ===== PANEL HEADER ===== */
  .panel-header {
    border-left: 4px solid var(--color-pink);
    padding-left: 1.5rem;
    margin-bottom: 2rem;
  }

  .panel-title {
    font-size: clamp(3rem, 7vw, 6rem);
    font-weight: 900;
    line-height: 0.9;
    letter-spacing: -0.02em;
    margin-bottom: 0.25rem;
  }

  .panel-code {
    font-size: clamp(1.5rem, 3.5vw, 3rem);
    font-weight: 900;
    line-height: 1;
    margin-bottom: 1.25rem;
  }

  .panel-meta {
    font-size: 1rem;
    font-weight: 600;
    line-height: 1.6;
  }

  .panel-meta p {
    margin: 0.125rem 0;
  }

  /* ===== PANEL BODY ===== */
  .panel-body {
    display: grid;
    grid-template-columns: minmax(220px, 360px) 1fr;
    gap: 2rem;
    align-items: start;
  }

  .panel-body.panel-body--single {
    grid-template-columns: 1fr;
  }

  .panel-gallery {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 1rem;
  }

  .panel-photo {
    margin: 0;
    border: 1px solid var(--color-charcoal);
    background: var(--color-charcoal);
    overflow: hidden;
  }

  .panel-photo img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .panel-text {
    font-size: 1.0625rem;
    font-weight: 600;
    line-height: 1.4;
  }

  .panel-text p {
    margin-bottom: 1.25rem;
  }

  .panel-text p:last-child {
    margin-bottom: 0;
  }

  /* Final border on the right of container */
  .curtains-container::after {
    content: "";
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    width: 3px;
    background: var(--color-charcoal);
    pointer-events: none;
  }

  /* ===== RESPONSIVE ===== */
  @media (max-width: 1200px) {
    .curtain-handle {
      width: 60px;
    }

    .curtain.open .curtain-handle {
      width: 75px;
    }

    .handle-label {
      font-size: 1rem;
    }

    .handle-code {
      font-size: 0.75rem;
    }

    .panel-inner {
      padding: 1.5rem 2rem;
      min-width: 450px;
    }

    .panel-body {
      grid-template-columns: minmax(150px, 250px) 1fr;
      gap: 1.5rem;
    }
  }

  @media (max-width: 900px) {
    .curtain-handle {
      width: 50px;
    }

    .curtain.open .curtain-handle {
      width: 60px;
    }

    .handle-label {
      font-size: 0.8125rem;
    }

    .handle-code {
      font-size: 0.6875rem;
    }

    .panel-inner {
      min-width: 350px;
    }

    .panel-body {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 600px) {
    .curtain-handle {
      width: 42px;
      padding-top: 1.5rem;
    }

    .curtain.open .curtain-handle {
      width: 50px;
    }

    .handle-label {
      font-size: 0.6875rem;
    }

    .handle-code {
      font-size: 0.5625rem;
    }

    .panel-inner {
      padding: 1.25rem 1.5rem;
      min-width: 200px;
    }

    .panel-title {
      font-size: 2rem;
    }

    .panel-code {
      font-size: 1.25rem;
    }

    .panel-text {
      font-size: 0.9375rem;
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const curtains = document.querySelectorAll<HTMLElement>(".curtain");
    const handles =
      document.querySelectorAll<HTMLButtonElement>(".curtain-handle");

    function openCurtain(index: number) {
      // Close all curtains
      curtains.forEach((c) => c.classList.remove("open"));
      handles.forEach((h) => h.setAttribute("aria-expanded", "false"));

      // Open the selected one
      curtains[index].classList.add("open");
      handles[index].setAttribute("aria-expanded", "true");
      updateContainerState();
    }

    function closeAll() {
      curtains.forEach((c) => c.classList.remove("open"));
      handles.forEach((h) => h.setAttribute("aria-expanded", "false"));
      updateContainerState();
    }

    function updateContainerState() {
      const container = document.querySelector<HTMLElement>(
        ".curtains-container"
      );
      if (!container) return;

      const hasOpen = Array.from(curtains).some((c) =>
        c.classList.contains("open")
      );
      if (hasOpen) {
        container.classList.remove("all-closed");
      } else {
        container.classList.add("all-closed");
      }
    }

    // Click handlers
    handles.forEach((handle, index) => {
      handle.addEventListener("click", () => {
        const isOpen = curtains[index].classList.contains("open");
        if (isOpen) {
          closeAll();
        } else {
          openCurtain(index);
        }
      });
    });

    // Keyboard navigation
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        closeAll();
        return;
      }

      const openIndex = Array.from(curtains).findIndex((c) =>
        c.classList.contains("open")
      );
      if (openIndex === -1) return;

      if (e.key === "ArrowRight") {
        e.preventDefault();
        const next = Math.min(openIndex + 1, curtains.length - 1);
        if (next !== openIndex) openCurtain(next);
      } else if (e.key === "ArrowLeft") {
        e.preventDefault();
        const prev = Math.max(openIndex - 1, 0);
        if (prev !== openIndex) openCurtain(prev);
      }
    });

    // Initialize container state
    updateContainerState();

    // Open first curtain by default
    openCurtain(0);
  });
</script>
